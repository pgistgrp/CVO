<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

    <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
        <property name="driverClassName">
           <value>org.postgresql.Driver</value>
        </property>
        <property name="url">
           <value>jdbc:postgresql://localhost/cvotest</value>
        </property>
        <property name="username">
           <value>pgist</value>
        </property>
        <property name="password">
           <value>pgist</value>
        </property>
    </bean>
    
    
    <bean id="sessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
        <property name="dataSource">
           <ref local="dataSource" />
        </property>
        <property name="mappingResources">
           <list>
               <value>org/pgist/users/User.hbm.xml</value>
               <value>org/pgist/users/Role.hbm.xml</value>
               <value>org/pgist/model/Discussible.hbm.xml</value>
               <value>org/pgist/model/DiscourseObject.hbm.xml</value>
               <value>org/pgist/model/Post.hbm.xml</value>
               <value>org/pgist/cvo/Category.hbm.xml</value>
               <value>org/pgist/cvo/Tag.hbm.xml</value>
               <value>org/pgist/workflow/DecisionSituation.hbm.xml</value>
               <value>org/pgist/wfengine/WorkflowEnvironment.hbm.xml</value>
               <value>org/pgist/wfengine/RunningContext.hbm.xml</value>
               <value>org/pgist/wfengine/Workflow.hbm.xml</value>
               <value>org/pgist/wfengine/Activity.hbm.xml</value>
               <value>org/pgist/wfengine/Template.hbm.xml</value>
               <value>org/pgist/wfengine/Task.hbm.xml</value>
               <value>org/pgist/wfengine/AccessManager.hbm.xml</value>
               <value>org/pgist/voting/VotePackage.hbm.xml</value>
               <value>org/pgist/voting/VoteSheet.hbm.xml</value>
               <value>org/pgist/voting/VoteItem.hbm.xml</value>
           </list>
        </property>
        <property name="hibernateProperties">
           <props>
               <prop key="hibernate.dialect">org.hibernate.dialect.PostgreSQLDialect</prop>
               <prop key="hibernate.show_sql">true</prop>
               <prop key="hibernate.cache.provider_class">org.hibernate.cache.EhCacheProvider</prop>
               <prop key="hibernate.default_batch_fetch_size">20</prop>
           </props>
        </property>
    </bean>
    
    
    <bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">
        <property name="sessionFactory">
           <ref local="sessionFactory" />
        </property>
    </bean>
    
    
    <!-- ========================= DAO DEFINITIONS: HIBERNATE IMPLEMENTATIONS ========================= -->
    
    
    <bean id="searchHelper" class="org.pgist.search.SearchHelper">
      <property name="indexPath">
        <value>/WEB-INF/lucene</value>
      </property>
    </bean>
    
    
    <bean id="userDAO" parent="baseTransactionProxy">
      <property name="target">
        <bean class="org.pgist.system.UserDAOImpl">
          <property name="sessionFactory">
            <ref local="sessionFactory" />
          </property>
        </bean>
      </property>
    </bean>
    
    
    <bean id="cvoDAO" parent="baseTransactionProxy">
      <property name="target">
        <bean class="org.pgist.cvo.CVODAOImpl">
          <property name="sessionFactory">
            <ref local="sessionFactory" />
          </property>
        </bean>
      </property>
    </bean>
    
    
    <bean id="cvoAgent" parent="baseTransactionProxy">
      <property name="target">
        <bean class="org.pgist.cvo.CVOAgent">
          <property name="userDAO" ref="userDAO"/>
          <property name="cvoDAO" ref="cvoDAO"/>
          <property name="searchHelper" ref="searchHelper"/>
        </bean>
      </property>
    </bean>
    
    
    <!-- Workflow Engine Beans -->
    
    
    <bean id="engineDAO" class="org.pgist.wfengine.WorkflowEngineDAOImpl">
        <property name="sessionFactory">
           <ref local="sessionFactory" />
        </property>
    </bean>
    
    
    <bean id="templateParser" class="org.pgist.wfengine.TemplateParser">
        <property name="engineDAO" ref="engineDAO"/>
    </bean>
    
    
    <bean id="pgameParser" class="org.pgist.wfengine.PGameParser">
        <property name="engineDAO" ref="engineDAO"/>
    </bean>
    
    
    <bean id="engine" parent="baseTransactionProxy">
      <property name="target">
        <bean class="org.pgist.wfengine.WorkflowEngine">
          <property name="engineDAO" ref="engineDAO"/>
          <property name="templateParser" ref="templateParser"/>
          <property name="pgameParser" ref="pgameParser"/>
        </bean>
      </property>
      <property name="transactionAttributes">
        <props>
          <prop key="spawn*">PROPAGATION_REQUIRED</prop>
          <prop key="execute*">PROPAGATION_REQUIRED</prop>
          <prop key="add*">PROPAGATION_REQUIRED</prop>
          <prop key="save*">PROPAGATION_REQUIRED</prop>
          <prop key="update*">PROPAGATION_REQUIRED</prop>
          <prop key="edit*">PROPAGATION_REQUIRED</prop>
          <prop key="create*">PROPAGATION_REQUIRED</prop>
          <prop key="delete*">PROPAGATION_REQUIRED</prop>
          <prop key="get*">PROPAGATION_REQUIRED,readOnly</prop>
        </props>
      </property>
    </bean>
    
    
    <!-- Workflow Management Beans -->
    
    
    <bean id="workflowDAO" class="org.pgist.workflow.WorkflowDAOImpl">
        <property name="sessionFactory">
           <ref local="sessionFactory" />
        </property>
    </bean>
    
    
    <bean id="workflowAgent" parent="baseTransactionProxy">
      <property name="target">
        <bean class="org.pgist.workflow.WorkflowAgent">
          <property name="engine" ref="engine"/>
          <property name="userDAO" ref="userDAO"/>
          <property name="workflowDAO" ref="workflowDAO"/>
        </bean>
      </property>
    </bean>
    
    
    <!-- PGame: BrainStorming -->
    
    
    <bean id="brainStormingDAO" parent="baseTransactionProxy">
      <property name="target">
        <bean class="org.pgist.workflow.pgame.brainstorming.BrainStormingDAOImpl">
          <property name="sessionFactory">
            <ref local="sessionFactory" />
          </property>
        </bean>
      </property>
    </bean>
    
    
    <bean id="brainStormingAgent" parent="baseTransactionProxy">
      <property name="target">
        <bean class="org.pgist.workflow.pgame.brainstorming.BrainStormingAgent">
          <property name="userDAO" ref="userDAO"/>
          <property name="brainStormingDAO" ref="brainStormingDAO"/>
          <property name="searchHelper" ref="searchHelper"/>
        </bean>
      </property>
    </bean>
    
    
    <!-- Workflow Modeling -->
    
    
    <bean id="wfModelingAgent" parent="baseTransactionProxy">
      <property name="target">
        <bean class="org.pgist.workflow.modeling.WFModelingAgent">
        </bean>
      </property>
    </bean>
    
    
</beans>

